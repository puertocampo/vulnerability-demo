import { createConnection } from 'typeorm';

async function createTable() {
  // DBが立ち上がるまで待つ
  await new Promise((resolve) => setTimeout(resolve, 2000));

  const connection = await createConnection({
    type: 'postgres',
    host: 'localhost',
    port: 5432,
    username: 'postgres',
    password: 'postgres',
    database: 'postgres',
    entities: [],
    // synchronize: false,
    synchronize: true,
  });

  // テーブル作成
  await connection.query(`
      DROP TABLE IF EXISTS "users";
    `);

  // テーブル作成
  await connection.query(`
      CREATE TABLE "users" (
        "id" SERIAL PRIMARY KEY,
        "name" VARCHAR(255) NOT NULL,
        "email" VARCHAR(255) NOT NULL,
        "password" VARCHAR(255) NOT NULL
      );
    `);
  console.log('Table "users" created successfully.');

  // ユーザを追加
  await connection.query(`
    INSERT INTO "users" (name, email, password) VALUES
    ('alice', 'alice@example.com', 'alicedayo'),
    ('bob', 'bob@example.com', 'bobdayo'),
    ('charlie', 'charlie@example.com', 'charliedayo'),
    ('daisy', 'daisy@example.com', 'daisydayo'),
    ('evan', 'evan@example.com', 'evandayo');
  `);
  console.log('User records inserted.');

  await connection.close();
}

createTable().catch((error) => console.log(error));
